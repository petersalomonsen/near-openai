const secretKey = Storage.privateGet("secretKey");

let iframeMessage = {
    command: 'createaccount'
};

if (secretKey) {
    iframeMessage.command = 'useaccount'
    iframeMessage.secretKey = secretKey;
}

function handleMessage(msg) {
    switch (msg.command) {
        case 'accountcreated':
            Storage.privateSet('secretKey', msg.secretKey);
            break;
    }
}

return <>
    <iframe message={iframeMessage} onMessage={handleMessage} src="data:text/html;base64,PCFET0NUWVBFIGh0bWw+CjxodG1sPgogICAgPGhlYWQ+CiAgICAgICAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xLjAiPgogICAgICAgIDxtZXRhIGNoYXJzZXQ9IlVURi04Ij4KICAgIDwvaGVhZD4KICAgIDxib2R5PgogICAgICAgIDx0ZXh0YXJlYSBpZD0icXVlc3Rpb250ZXh0YXJlYSI+PC90ZXh0YXJlYT4KICAgICAgICA8YnV0dG9uIGlkPSJhc2tfYWlfYnV0dG9uIj5Bc2sgQUk8L2J1dHRvbj4KICAgICAgICA8cCBpZD0icmVzcG9uc2VhcmVhIj48L3A+CiAgICAgICAgPHA+CiAgICAgICAgICAgIFNwZW5kaW5nIGZ1bmRzIGZyb20gYWNjb3VudDogPHNwYW4gaWQ9ImFjY291bnRpZHNwYW4iPjwvc3Bhbj4KICAgICAgICA8L3A+CiAgICA8L2JvZHk+CiAgICA8c2NyaXB0IHR5cGU9Im1vZHVsZSI+aW1wb3J0Imh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vbmVhci1hcGktanNAMi4xLjMvZGlzdC9uZWFyLWFwaS1qcy5taW4uanMiO2ltcG9ydCJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL2pzLXNoYTI1NkAwLjkuMC9zcmMvc2hhMjU2Lm1pbi5qcyI7Y29uc3QgZT0ibWFpbm5ldCIsbj1uZXcgbmVhckFwaS5rZXlTdG9yZXMuSW5NZW1vcnlLZXlTdG9yZSx0PXtrZXlTdG9yZTpuLG5ldHdvcmtJZDplLG5vZGVVcmw6YGh0dHBzOi8vcnBjLiR7ZX0ubmVhci5vcmdgLHdhbGxldFVybDpgaHR0cHM6Ly93YWxsZXQuJHtlfS5uZWFyLm9yZ2AsaGVscGVyVXJsOmBodHRwczovL2hlbHBlci4ke2V9Lm5lYXIub3JnYCxleHBsb3JlclVybDpgaHR0cHM6Ly9leHBsb3Jlci4ke2V9Lm5lYXIub3JnYH07YXN5bmMgZnVuY3Rpb24gYSgpe2NvbnN0IHQ9bmVhckFwaS51dGlscy5LZXlQYWlyRWQyNTUxOS5mcm9tUmFuZG9tKCksYT1CdWZmZXIuZnJvbSh0LnB1YmxpY0tleS5kYXRhKS50b1N0cmluZygiaGV4Iik7cmV0dXJuIGF3YWl0IG4uc2V0S2V5KGUsYSx0KSx0LnNlY3JldEtleX1hc3luYyBmdW5jdGlvbiBzKGEpe2NvbnN0IHM9YXdhaXQgbmVhckFwaS5jb25uZWN0KHQpLHI9YXdhaXQgcy5hY2NvdW50KChhd2FpdCBuLmdldEFjY291bnRzKGUpKVswXSksYz1yLmFjY291bnRJZCxvPUpTT04uc3RyaW5naWZ5KGEpLGk9MTAwMDAwMDAwMDAwMDAwMDAwMDBuKkJpZ0ludChvLmxlbmd0aCksZD1zaGEyNTYobyksdT1hd2FpdCByLmNvbm5lY3Rpb24uc2lnbmVyLmdldFB1YmxpY0tleShyLmFjY291bnRJZCxyLmNvbm5lY3Rpb24ubmV0d29ya0lkKSxsPShhd2FpdCByLmZpbmRBY2Nlc3NLZXkoKSkuYWNjZXNzS2V5O2NvbnNvbGUubG9nKGwpO2NvbnN0IHA9KytsLm5vbmNlLG09bmVhckFwaS51dGlscy5zZXJpYWxpemUuYmFzZV9kZWNvZGUobC5ibG9ja19oYXNoKSxnPW5lYXJBcGkudHJhbnNhY3Rpb25zLmNyZWF0ZVRyYW5zYWN0aW9uKHIuYWNjb3VudElkLHUsImpzaW5ydXN0Lm5lYXIiLHAsW25lYXJBcGkudHJhbnNhY3Rpb25zLmZ1bmN0aW9uQ2FsbCgiYXNrX2FpIix7bWVzc2FnZV9oYXNoOmR9LCIzMDAwMDAwMDAwMDAwMCIsaSldLG0pLFt5LGhdPWF3YWl0IG5lYXJBcGkudHJhbnNhY3Rpb25zLnNpZ25UcmFuc2FjdGlvbihnLHIuY29ubmVjdGlvbi5zaWduZXIsci5hY2NvdW50SWQsci5jb25uZWN0aW9uLm5ldHdvcmtJZCk7cmV0dXJuIEpTT04uc3RyaW5naWZ5KHtzaWduZWRfdHJhbnNhY3Rpb246QnVmZmVyLmZyb20oaC5lbmNvZGUoKSkudG9TdHJpbmcoImJhc2U2NCIpLHRyYW5zYWN0aW9uX2hhc2g6bmVhckFwaS51dGlscy5zZXJpYWxpemUuYmFzZV9lbmNvZGUoeSksc2VuZGVyX2FjY291bnRfaWQ6YyxtZXNzYWdlczphfSl9YXN5bmMgZnVuY3Rpb24gcihlKXt0cnl7cmV0dXJuKGF3YWl0IGZldGNoKCJodHRwczovL25lYXItb3BlbmFpLnZlcmNlbC5hcHAvYXBpL29wZW5haSIse21ldGhvZDoiUE9TVCIsYm9keTplfSkudGhlbigoZT0+ZS5qc29uKCkpKSkuY2hvaWNlc1swXS5tZXNzYWdlLmNvbnRlbnR9Y2F0Y2goZSl7cmV0dXJuIGUubWVzc2FnZX19d2luZG93Lm9ubWVzc2FnZT1hc3luYyB0PT57c3dpdGNoKHQuZGF0YS5jb21tYW5kKXtjYXNlImNyZWF0ZWFjY291bnQiOndpbmRvdy5wYXJlbnQucG9zdE1lc3NhZ2Uoe2NvbW1hbmQ6ImFjY291bnRjcmVhdGVkIixzZWNyZXRLZXk6YXdhaXQgYSgpfSx0Lm9yaWdpbik7YnJlYWs7Y2FzZSJ1c2VhY2NvdW50IjohYXN5bmMgZnVuY3Rpb24odCl7Y29uc3QgYT1uZWFyQXBpLnV0aWxzLktleVBhaXIuZnJvbVN0cmluZyh0KSxzPUJ1ZmZlci5mcm9tKGEucHVibGljS2V5LmRhdGEpLnRvU3RyaW5nKCJoZXgiKTthd2FpdCBuLnNldEtleShlLHMsYSksZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImFjY291bnRpZHNwYW4iKS5pbm5lckhUTUw9c30odC5kYXRhLnNlY3JldEtleSl9fSxkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYXNrX2FpX2J1dHRvbiIpLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwoYXN5bmMoKT0+e2NvbnN0IGU9YXdhaXQgcyhbe3JvbGU6InVzZXIiLGNvbnRlbnQ6ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInF1ZXN0aW9udGV4dGFyZWEiKS52YWx1ZX1dKSxuPWF3YWl0IHIoZSk7Y29uc29sZS5sb2cobiksZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInJlc3BvbnNlYXJlYSIpLmlubmVySFRNTD1ufSkpO2V4cG9ydHtzIGFzIGNyZWF0ZV9hc2tfYWlfcmVxdWVzdF9ib2R5LHIgYXMgc2VuZF9hc2tfYWlfcmVxdWVzdH07Cjwvc2NyaXB0Pgo8L2h0bWw+" style={{width: '640px', height: '400px'}}></iframe>
</>;