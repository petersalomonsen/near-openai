const secretKey = Storage.privateGet("secretKey");

State.init({airesponse: ''});

let iframeMessage = {
    command: 'createaccount'
};

if (secretKey) {
    iframeMessage.command = 'useaccount'
    iframeMessage.secretKey = secretKey;
}

function handleMessage(msg) {
    switch (msg.command) {
        case 'accountcreated':
            Storage.privateSet('secretKey', msg.secretKey);
            break;
        case 'airesponse':
            State.update({airesponse: msg.airesponse});
            break;
    }
}

return <>
    <iframe message={iframeMessage} onMessage={handleMessage} src="data:text/html;base64,PCFET0NUWVBFIGh0bWw+CjxodG1sPgogICAgPGhlYWQ+CiAgICAgICAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xLjAiPgogICAgICAgIDxtZXRhIGNoYXJzZXQ9IlVURi04Ij4KICAgIDwvaGVhZD4KICAgIDxib2R5PgogICAgICAgIDx0ZXh0YXJlYSBpZD0icXVlc3Rpb250ZXh0YXJlYSI+PC90ZXh0YXJlYT4KICAgICAgICA8YnV0dG9uIGlkPSJhc2tfYWlfYnV0dG9uIj5Bc2sgQUk8L2J1dHRvbj4KICAgICAgICA8cD4KICAgICAgICAgICAgU3BlbmRpbmcgZnVuZHMgZnJvbSBhY2NvdW50OiA8c3BhbiBpZD0iYWNjb3VudGlkc3BhbiI+PC9zcGFuPgogICAgICAgIDwvcD4KICAgIDwvYm9keT4KICAgIDxzY3JpcHQgdHlwZT0ibW9kdWxlIj5pbXBvcnQiaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9uZWFyLWFwaS1qc0AyLjEuMy9kaXN0L25lYXItYXBpLWpzLm1pbi5qcyI7aW1wb3J0Imh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vanMtc2hhMjU2QDAuOS4wL3NyYy9zaGEyNTYubWluLmpzIjtjb25zdCBlPSJtYWlubmV0IixuPW5ldyBuZWFyQXBpLmtleVN0b3Jlcy5Jbk1lbW9yeUtleVN0b3JlLHQ9e2tleVN0b3JlOm4sbmV0d29ya0lkOmUsbm9kZVVybDpgaHR0cHM6Ly9ycGMuJHtlfS5uZWFyLm9yZ2Asd2FsbGV0VXJsOmBodHRwczovL3dhbGxldC4ke2V9Lm5lYXIub3JnYCxoZWxwZXJVcmw6YGh0dHBzOi8vaGVscGVyLiR7ZX0ubmVhci5vcmdgLGV4cGxvcmVyVXJsOmBodHRwczovL2V4cGxvcmVyLiR7ZX0ubmVhci5vcmdgfTthc3luYyBmdW5jdGlvbiBhKCl7Y29uc3QgdD1uZWFyQXBpLnV0aWxzLktleVBhaXJFZDI1NTE5LmZyb21SYW5kb20oKSxhPUJ1ZmZlci5mcm9tKHQucHVibGljS2V5LmRhdGEpLnRvU3RyaW5nKCJoZXgiKTtyZXR1cm4gYXdhaXQgbi5zZXRLZXkoZSxhLHQpLHQuc2VjcmV0S2V5fWFzeW5jIGZ1bmN0aW9uIHIoYSl7Y29uc3Qgcj1hd2FpdCBuZWFyQXBpLmNvbm5lY3QodCkscz1hd2FpdCByLmFjY291bnQoKGF3YWl0IG4uZ2V0QWNjb3VudHMoZSkpWzBdKSxvPXMuYWNjb3VudElkLGk9SlNPTi5zdHJpbmdpZnkoYSksYz0xMDAwMDAwMDAwMDAwMDAwMDAwMG4qQmlnSW50KGkubGVuZ3RoKSxsPXNoYTI1NihpKSxkPWF3YWl0IHMuY29ubmVjdGlvbi5zaWduZXIuZ2V0UHVibGljS2V5KHMuYWNjb3VudElkLHMuY29ubmVjdGlvbi5uZXR3b3JrSWQpLHA9KGF3YWl0IHMuZmluZEFjY2Vzc0tleSgpKS5hY2Nlc3NLZXk7Y29uc29sZS5sb2cocCk7Y29uc3QgdT0rK3Aubm9uY2UsZz1uZWFyQXBpLnV0aWxzLnNlcmlhbGl6ZS5iYXNlX2RlY29kZShwLmJsb2NrX2hhc2gpLGg9bmVhckFwaS50cmFuc2FjdGlvbnMuY3JlYXRlVHJhbnNhY3Rpb24ocy5hY2NvdW50SWQsZCwianNpbnJ1c3QubmVhciIsdSxbbmVhckFwaS50cmFuc2FjdGlvbnMuZnVuY3Rpb25DYWxsKCJhc2tfYWkiLHttZXNzYWdlX2hhc2g6bH0sIjMwMDAwMDAwMDAwMDAwIixjKV0sZyksW20seV09YXdhaXQgbmVhckFwaS50cmFuc2FjdGlvbnMuc2lnblRyYW5zYWN0aW9uKGgscy5jb25uZWN0aW9uLnNpZ25lcixzLmFjY291bnRJZCxzLmNvbm5lY3Rpb24ubmV0d29ya0lkKTtyZXR1cm4gSlNPTi5zdHJpbmdpZnkoe3NpZ25lZF90cmFuc2FjdGlvbjpCdWZmZXIuZnJvbSh5LmVuY29kZSgpKS50b1N0cmluZygiYmFzZTY0IiksdHJhbnNhY3Rpb25faGFzaDpuZWFyQXBpLnV0aWxzLnNlcmlhbGl6ZS5iYXNlX2VuY29kZShtKSxzZW5kZXJfYWNjb3VudF9pZDpvLG1lc3NhZ2VzOmF9KX1hc3luYyBmdW5jdGlvbiBzKGUpe3RyeXtyZXR1cm4oYXdhaXQgZmV0Y2goImh0dHBzOi8vbmVhci1vcGVuYWkudmVyY2VsLmFwcC9hcGkvb3BlbmFpIix7bWV0aG9kOiJQT1NUIixib2R5OmV9KS50aGVuKChlPT5lLmpzb24oKSkpKS5jaG9pY2VzWzBdLm1lc3NhZ2UuY29udGVudH1jYXRjaChlKXtyZXR1cm5gVW5mb3J0dW5hdGVseSwgdGhlcmUgd2FzIGFuIGVycm9yOlxuXG5cYFxgXGAke0pTT04uc3RyaW5naWZ5KGUsbnVsbCwxKX1cYFxgXGBgfX13aW5kb3cub25tZXNzYWdlPWFzeW5jIHQ9Pntzd2l0Y2goZ2xvYmFsVGhpcy5wYXJlbnRPcmlnaW49dC5vcmlnaW4sdC5kYXRhLmNvbW1hbmQpe2Nhc2UiY3JlYXRlYWNjb3VudCI6d2luZG93LnBhcmVudC5wb3N0TWVzc2FnZSh7Y29tbWFuZDoiYWNjb3VudGNyZWF0ZWQiLHNlY3JldEtleTphd2FpdCBhKCl9LGdsb2JhbFRoaXMucGFyZW50T3JpZ2luKTticmVhaztjYXNlInVzZWFjY291bnQiOiFhc3luYyBmdW5jdGlvbih0KXtjb25zdCBhPW5lYXJBcGkudXRpbHMuS2V5UGFpci5mcm9tU3RyaW5nKHQpLHI9QnVmZmVyLmZyb20oYS5wdWJsaWNLZXkuZGF0YSkudG9TdHJpbmcoImhleCIpO2F3YWl0IG4uc2V0S2V5KGUscixhKSxkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYWNjb3VudGlkc3BhbiIpLmlubmVySFRNTD1yfSh0LmRhdGEuc2VjcmV0S2V5KX19LGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhc2tfYWlfYnV0dG9uIikuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLChhc3luYygpPT57Y29uc3QgZT1hd2FpdCByKFt7cm9sZToidXNlciIsY29udGVudDpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicXVlc3Rpb250ZXh0YXJlYSIpLnZhbHVlfV0pO2NvbnNvbGUubG9nKGUpO2NvbnN0IG49YXdhaXQgcyhlKTtjb25zb2xlLmxvZyhuKSx3aW5kb3cucGFyZW50LnBvc3RNZXNzYWdlKHtjb21tYW5kOiJhaXJlc3BvbnNlIixhaXJlc3BvbnNlOm59LGdsb2JhbFRoaXMucGFyZW50T3JpZ2luKX0pKTtleHBvcnR7ciBhcyBjcmVhdGVfYXNrX2FpX3JlcXVlc3RfYm9keSxzIGFzIHNlbmRfYXNrX2FpX3JlcXVlc3R9Owo8L3NjcmlwdD4KPC9odG1sPg==" style={{width: '640px', height: '400px'}}></iframe>
    <Markdown text={state.airesponse} />
    <p><pre>{secretKey}</pre></p>
</>;